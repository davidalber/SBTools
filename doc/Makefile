# Makefile for producing pdf and html files from DocBook source.
#
# Based on September 2002 Makefile by Rouben Rostmaian for LaTeX.
#
# To make a pdf file, type "make pdf" or simply "make".
# To make an html file, type "make html".
# To remove all files generated by make, type "make clean".
#
# David Alber, December 2008.

# NOTE: set the XMLFILE variable to be the main file of the
# documatation, and set the SOURCES variable to the other source file
# dependencies of the project.
#
# If SOURCES is not set properly, the build still works, with the
# exception of dependency detection, meaning that make will not always
# recognize when there is something to do.

XMLFILE = sbtools.xml
SOURCES = ch01-introduction.xml \
	  ch02-installation.xml \
	  ch03-usage.xml \
	  ch04-design.xml \
	  ch05-developing-plugins.xml \
	  app-a-blank-py.xml \
	  version.xml

FOP = fop
XSLPATH = $(HOME)/Packages/docbook-xsl-ns-1.74.3

.PHONY: pdf clean

# Tell make to not delete the .fo file after completion.
.SECONDARY: $(TEXFILE:.xml=.fo)

pdf:    $(XMLFILE:.xml=.pdf)

html:	$(XMLFILE) $(SOURCES)
	xsltproc -o $(<:.xml=.html) $(XSLPATH)/xhtml/docbook.xsl $<

%.pdf: %.fo
	$(FOP) $< $@

%.fo: %.xml $(SOURCES)
	xsltproc $(XSLPATH)/fo/docbook.xsl $< > $@

clean:
	@\rm -f \
	$(XMLFILE:.xml=.pdf) \
	$(XMLFILE:.xml=.fo) \
	$(XMLFILE:.xml=.html) \
	*~
